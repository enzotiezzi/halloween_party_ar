<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>O Espelho Sussurra...</title>
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-troika-text@0.11.0/dist/aframe-troika-text.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
        }

        /* Efeito de tremor sutil e perturbador */
        .shake {
            animation: creepyShake 0.15s infinite;
        }

        @keyframes creepyShake {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
            }

            10% {
                transform: translate(-1px, 1px) rotate(-0.3deg);
            }

            20% {
                transform: translate(1px, -1px) rotate(0.3deg);
            }

            30% {
                transform: translate(-1px, -1px) rotate(-0.2deg);
            }

            40% {
                transform: translate(1px, 1px) rotate(0.2deg);
            }

            50% {
                transform: translate(-1px, 0) rotate(-0.1deg);
            }

            60% {
                transform: translate(1px, 0) rotate(0.1deg);
            }

            70% {
                transform: translate(0, -1px) rotate(-0.2deg);
            }

            80% {
                transform: translate(0, 1px) rotate(0.2deg);
            }

            90% {
                transform: translate(-1px, 1px) rotate(-0.1deg);
            }
        }
    </style>
</head>

<body>
    <a-scene mindar-image="imageTargetSrc: ./espelho.mind; autoStart: true;" color-space="sRGB"
        renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: true">
        <a-assets>
            <audio id="sussurro"
                src="https://cdn.pixabay.com/download/audio/2023/04/07/audio_fa96c63df9.mp3?filename=ghost-breath-145018.mp3"></audio>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: true"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <!-- Névoa escura atmosférica em 3D com múltiplas camadas -->
            <a-entity geometry="primitive: plane; width: 2; height: 1.5"
                material="color: #0a0000; opacity: 0.7; side: double" position="0 0 -0.05"
                animation="property: material.opacity; to: 0.85; dur: 3000; dir: alternate; loop: true; easing: easeInOutSine"></a-entity>

            <a-entity geometry="primitive: plane; width: 1.8; height: 1.3"
                material="color: #1a0000; opacity: 0.5; side: double" position="0 0 -0.03"
                animation="property: material.opacity; to: 0.7; dur: 2500; dir: alternate; loop: true; delay: 500; easing: easeInOutSine"></a-entity>

            <!-- Texto assustador principal com múltiplos efeitos creepy -->
            <a-entity id="frase"
                position="0 0 0.15" scale="1 1 1"
                animation="property: scale; to: 1.08 1.08 1.08; dur: 1500; dir: alternate; loop: true; easing: easeInOutSine"
                animation__opacity="property: troika-text.fillOpacity; from: 0.7; to: 1; dur: 2000; dir: alternate; loop: true; easing: easeInOutQuad"
                animation__position="property: position; to: 0.01 0.01 0.17; dur: 150; dir: alternate; loop: true; easing: linear"
                animation__rotation="property: rotation; to: 0 0 1.5; dur: 2500; dir: alternate; loop: true; easing: easeInOutSine"></a-entity>

            <!-- Som fantasmagórico -->
            <a-sound src="#sussurro" autoplay="false" id="som" loop="true" volume="0.7"></a-sound>
        </a-entity>

        <script>
            // Aguarda o carregamento da cena
            document.querySelector('a-scene').addEventListener('loaded', () => {
                const frase = document.querySelector("#frase");

                // Define o texto com troika-text para suporte completo a Unicode
                frase.setAttribute('troika-text', {
                    value: 'O assassino não tem reflexo.\nMas alguém o viu — e não viveu para contar.',
                    color: '#8B0000',
                    align: 'center',
                    maxWidth: 1.5,
                    fontSize: 0.08,
                    lineHeight: 1.2,
                    anchorX: 'center',
                    anchorY: 'middle'
                });

                // Adiciona classe CSS de tremor
                frase.classList.add("shake");
            });

            // Ativa o som quando o target é detectado
            document.addEventListener("targetFound", () => {
                const som = document.querySelector("#som");
                if (som && !som.components.sound.isPlaying) {
                    som.components.sound.playSound();
                }
            });

            document.addEventListener("targetLost", () => {
                const som = document.querySelector("#som");
                if (som && som.components.sound.isPlaying) {
                    som.components.sound.stopSound();
                }
            });
        </script>
    </a-scene>
</body>

</html>